<!DOCTYPE HTML>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Epsilon Mobile Framework - Version 2.0</title>
    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <link href="styles/framework.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.carousel.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css" rel="stylesheet" type="text/css">
    <link href="styles/colorbox.css" rel="stylesheet" type="text/css">
    <link href="styles/general.css" rel="stylesheet" type="text/css">
    <style>
        .star
        {
            display: inline;
            background-image: url(../images/misc/facebook.png);
            margin: 0px 0px 0px 47px;
        }

        .submenu-nav-items a {
            padding-left: 20px !important;
            padding-top: 10px !important;
            padding-bottom: 10px !important;
            border-bottom: solid 1px rgba(0,0,0,0.1) !important;
        }

        .vinculo_derecha {
            float: right;
            padding-right: 1%;
        }

        .vinculo_izquierda {
            float: left;
            padding-left: 1%;
            display: none;
        }
    </style>

    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/owl.carousel.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.swipebox.js"></script>
    <script type="text/javascript" src="scripts/colorbox.js"></script>
    <script type="text/javascript" src="scripts/snap.js"></script>
    <script type="text/javascript" src="scripts/contact.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script type="text/javascript" src="scripts/framework.js"></script>
    <script type="text/javascript" src="scripts/framework.launcher.js"></script>
    <script type="text/javascript" src="scripts/bd.js"></script>

    <script>
        $(document).ready(function () {
            if (doesConnectionExist()) {
                $("#label-internet-connection").text("Online");
                $("#div-internet-connection").css("background-color", "#80d580");
            } else {
                $("#label-internet-connection").text("Offline");
                $("#div-internet-connection").css("background-color", "#ec8787");
            }
            consultarVacante();
        });

        function consultarVacante() {
            var db = window.openDatabase("bd_vacantes", "1.0", "vacantes", 200000);
            db.transaction(consultar_listaVacantes, errorConsultarVacantes, function () {
                console.log("Consultó las vacantes")
            });
        }

        function consultar_listaVacantes(tx) {
            tx.executeSql("SELECT * FROM vacantes ORDER BY fecha_vencimiento ASC", [], validar_listadoVacantes, function (error) {
                console.log("Error consultado el listado de vacantes: " + error)
            });
        }

        function validar_listadoVacantes(tx, results) {
            var len = results.rows.length;
            var texto = "";
            var n = 0;
            if (len > 0) {
                for (var i = 0; i < len; i++) {
                    //Consultamos la vacante para actualizarla si tiene conexión a Internet
                    //var id_vacante = results.rows.item(i).id;
                    //var fecha_actualizacion = results.rows.item(i).fecha_actualizacion;
                    //if ($("#label-internet-connection").text() == "Online") {
                    //    $.ajax({
                    //        url: 'http://apiempleo.apphb.com/api/Vacante/obtenerVacante/' + id_vacante,
                    //        type: 'POST',
                    //        dataType: 'json',
                    //        success: function (data, textStatus, xhr) {
                    //            if (fecha_actualizacion == data['Ultima_Actualizacion'])
                    //                alert(data['Titulo']);
                    //        },
                    //        error: function (xhr, textStatus, errorThrown) {
                    //            alert(errorThrown);
                    //        }
                    //    });
                    //}

                    //alert(results.rows.item(i).titulo);
                    var rutaEstrella = "images/estrella_llena.png";
                    var textoFavorita ="Quitar de favoritas";
                    n = results.rows.item(i).fecha_vencimiento.indexOf('T');
                    texto += '<div class="container" id="vacanteFavorita_' + results.rows.item(i).id + '">' +
                            '<div class="toggle-2">' +
                                '<a href="#" class="deploy-toggle-2 toggle-2">' +
                                    results.rows.item(i).titulo + '<label style="font-weight: bolder; font-size: 15px; color: black;">';
                    if (results.rows.item(i).dias_vence == 1)
                        texto += 'Vence HOY</label>';
                    else
                        texto += 'Vence en ' + results.rows.item(i).dias_vence + ' días</label>';
                    texto += '</a>' +
                            '<div class="toggle-content">' +
                                '<p style="text-align:justify;">' +
                                    results.rows.item(i).descripcion +
                                    '<label>' +
                                        'Número de vacantes: <b>' + results.rows.item(i).vacantes + '</b></label>' +
                                    '<label>' +
                                        'Cargo: <b>' + results.rows.item(i).cargo + '</b></label>' +
                                    '<label>' +
                                        'Salario: <b>' + results.rows.item(i).nombre_salario + '</b></label>' +
                                    '<label>' +
                                        'Sector: <b>' + results.rows.item(i).sector + '</b></label>' +
                                    '<label>' +
                                        'Experiencia: <b>' + results.rows.item(i).nombre_experiencia + '</b></label>' +
                                    '<label>' +
                                        'Nivel de Estudios: <b>' + results.rows.item(i).nombre_nivel + '</b></label>' +
                                    '<label>' +
                                        'Profesión: <b>' + results.rows.item(i).profesion + '</b></label>' +
                                    '<label>' +
                                        'Departamento: <b>' + results.rows.item(i).nombre_departamento + '</b></label>' +
                                    '<label>' +
                                        'Municipio: <b>' + results.rows.item(i).nombre_municipio + '</b></label>' +
                                    '<label>' +
                                        'Fecha Vencimiento: <b>' + results.rows.item(i).fecha_vencimiento.substring(0, n) + '</b></label>' +
                                '</p>' +
                                '<div class="toggle-content">' +
                                    '<p><strong>Datos del Empleador:</strong></p>' +
                                    '<div class="one-half-responsive ">' +
                                        '<div class="submenu-navigation">' +
                                            '<div class="submenu-nav-items" style="overflow: hidden; display: block;"></div>' +
                                            '<a name="#" style="border-top: solid 1px rgba(0,0,0,0.1); padding-left: 20px !important; padding-top: 10px !important; padding-bottom: 10px !important; border-bottom: solid 1px rgba(0,0,0,0.1) !important;">' +
                                                '<ul style="margin-bottom:0px;" class="icon-list">' +
                                                    '<li class="right-list">Teléfono (Indicativo): <b>' + results.rows.item(i).telefono + ' (' + results.rows.item(i).indicativo + ')</b></li>' +
                                                '</ul>' +
                                            '</a>' +
                                            '<a name="#" style="border-top: solid 1px rgba(0,0,0,0.1); padding-left: 20px !important; padding-top: 10px !important; padding-bottom: 10px !important; border-bottom: solid 1px rgba(0,0,0,0.1) !important;">' +
                                                '<ul style="margin-bottom:0px;" class="icon-list">' +
                                                    '<li class="right-list">Celular: <b>' + results.rows.item(i).celular + '</b></li>' +
                                                '</ul>' +
                                            '</a>' +
                                            '<a name="#" style="border-top: solid 1px rgba(0,0,0,0.1); padding-left: 20px !important; padding-top: 10px !important; padding-bottom: 10px !important; border-bottom: solid 1px rgba(0,0,0,0.1) !important;">' +
                                                '<ul style="margin-bottom:0px;" class="icon-list">' +
                                                    '<li class="right-list">Dirección: <b>' + results.rows.item(i).direccion + '</b></li>' +
                                                '</ul>' +
                                            '</a>' +
                                            '<a name="#" style="border-top: solid 1px rgba(0,0,0,0.1); padding-left: 20px !important; padding-top: 10px !important; padding-bottom: 10px !important; border-bottom: solid 1px rgba(0,0,0,0.1) !important;">' +
                                                '<ul style="margin-bottom:0px;" class="icon-list">' +
                                                    '<li class="right-list">E-mail: <b>' + results.rows.item(i).email + '</b></li>' +
                                                '</ul>' +
                                            '</a>';
                    if ($("#label-internet-connection").text() == "Online")
                        texto += '<a name="#" style="text-align:center !important; border-top: solid 1px rgba(0,0,0,0.1); padding-left: 20px !important; padding-top: 10px !important; padding-bottom: 10px !important; border-bottom: solid 1px rgba(0,0,0,0.1) !important;">' +
                                         'Comparta esta oportunidad de trabajo' +
                                             '<ul style="margin-bottom:0px;" class="icon-list">' +
                                                 '<li style="padding-left:0px !important;">' +
                                                     '<img src="images/misc/facebook.png" style="margin: 0px !important; padding-right: 3%;" class="star" onclick="abrirPaginaFacebook(\'' + results.rows.item(i).titulo + '\', ' + results.rows.item(i).id + ')"/>' +
                                                     '<img src="images/misc/twitter.png" class="star" style="padding-left: 3%" onclick="abrirPaginaTwitter(\'' + results.rows.item(i).titulo + '\', ' + results.rows.item(i).id + ')"/>' +
                                                 '</li>' +
                                             '</ul>' +
                                         '</a>';
                    texto += '</div>' +
                            '</div>' +
                            '<div class="one-half-responsive" style="text-align:center !important;">' +
                                    '<div onclick=\"eliminarfavorita(' + results.rows.item(i).id + ');\" style="width: 50%; float: left;"><img id="estrella' + results.rows.item(i).id + '" class="star" style="margin: 0px !important; width:auto !important;" src="' + rutaEstrella + '" style="width: 20px;" /><label>' + textoFavorita + '</label></div>';
                                        if ($("#label-internet-connection").text() == "Online")
                                            texto += '<div id="btnDen' + results.rows.item(i).id + '" style="padding-left: 20px; width: 50%; float: left;margin-top: 5px; display:block;"><a name="#" onclick="Denunciar(' + results.rows.item(i).id + ')" class="button-icon icon-setting button-red">Denunciar</a></div>' +
                                            '<div id="comboDen' + results.rows.item(i).id + '" style="padding-left: 20px; width: 50%; float: left;margin-top: 5px; display:none;">Motivo de la denuncia: <br />' +
                                            '<select class="styled-select" name="selectMotivoDenuncia' + results.rows.item(i).id + '" id="selectMotivoDenuncia' + results.rows.item(i).id + '">' +
                                            '<option value="1">Vacante sospechosa / engañosa</option>' +
                                            '<option value="2">Lenguaje no adecuado</option>' +
                                            '<option value="3">Información de contacto errónea </option>' +
                                            '<option value="4">Sospecha de Trata de personas</option>' +
                                        '</select>' +
                                        '<br /> <a name="#" onclick="GuardarDenuncia(' + results.rows.item(i).id + ')" class="button-icon icon-setting button-red">Confirmar denuncia</a>&nbsp;<a name="#" onclick="CancelarDenuncia(' + results.rows.item(i).id + ')" class="button-icon icon-setting button-red">Cancelar</a>' +
                                        '</div>';
                                   texto += '</div>' +
                            '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                    '</div>';
                }

                $("#ofertas").html(texto);

                $('.deploy-toggle-2').click(function () {
                    $(this).parent().find('.toggle-content').toggle(100);
                    $(this).toggleClass('toggle-2-active');
                    return false;
                });
                OcultarDivCargando();
                $("#div_sin_favoritas").fadeOut();
            }
            else {
                $("#div_sin_favoritas").fadeIn();
            }
        }

        function eliminarfavorita(id) {
            var id_vacante = id;
            function execute(tx) {
                tx.executeSql('DELETE FROM vacantes WHERE id = \'' + id_vacante + '\'');
            }

            function error(error) {
                console.log("Error al configurar base de datos", error)
            }

            function exito() {
                localStorage.setItem("vacantesGuardadas", localStorage.getItem("vacantesGuardadas").replace("id" + id_vacante + ",", ""));
                $("#vacanteFavorita_" + id_vacante).fadeOut();
                console.log("Configuración exitosa")
            }

            var db = window.openDatabase("bd_vacantes", "1.0", "Vacantes", 200000);
            db.transaction(execute, error, exito);

        }

        function Denunciar(id) {
            $("#btnDen" + id).hide();
            $("#comboDen" + id).show();
            //alert("Denuncia: "+id)
        }

        function GuardarDenuncia(id) {
            //alert("Guardar: "+id+" Motivo: "+$("#selectMotivoDenuncia"+id).val());
            var denuncia = new Object();
            denuncia.Fecha = null;
            denuncia.Tipo = $("#selectMotivoDenuncia" + id + " option:selected").html();
            denuncia.vacanteID = id;

            $.ajax({
                url: 'http://apiempleo.apphb.com/api/Vacante/agregarDenuncia',
                type: 'POST',
                dataType: 'json',
                contentType: "application/json",
                data: JSON.stringify(denuncia),
                success: function (data, textStatus, xhr) {
                    alert(data);
                    if (data == "Denuncia creada correctamente") {
                        $("#btnDen" + id).show();
                        $("#comboDen" + id).hide();
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });

        }

        function CancelarDenuncia(id) {
            $("#btnDen" + id).show();
            $("#comboDen" + id).hide();
        }

        function abrirPaginaFacebook(nombre, id) {
            window.open("https://www.facebook.com/share.php?u=http://empleomovil.apphb.com/Vacantes/Details/" + id, "_blank", "closebuttoncaption=Regresar");
        }

        function abrirPaginaTwitter(nombre, id) {
            window.open("https://twitter.com/home?status=Oportunidad de trabajo: " + nombre + " https://www.mintransporte.gov.co/noticias.php/", "_blank", "closebuttoncaption=Regresar");
        }

        function errorConsultarVacantes(err) {
            console.log(err);
            alert("Error consultando listado de vacantes" + err);
        }

        function cargarOfertas(palabra) {
            $("#map_canvas").hide();

            MostrarDivCargando();
            var vectorConectores = ["a", "ante", "bajo", "con", "contra", "de", "desde", "en", "entre", "hacia", "hasta", "para", "por", "según", "segun", "sin", "sobre", "tras", " ", "  ", "   ", ""];

            if (palabra != "") {
                palabra = palabra.trim();
                var palabrasSeparadas = palabra.split(" ");
                var fraseDefinitiva = "";
                var palabraAuxiliar = "";

                for (x = 0; x < palabrasSeparadas.length; x++) {
                    palabraAuxiliar = palabrasSeparadas[x];
                    palabrasSeparadas[x] = palabraAuxiliar.trim().toLowerCase();
                }

                fraseDefinitiva += palabrasSeparadas[0];

                for (x = 1; x < palabrasSeparadas.length; x++) {
                    if ($.inArray(palabrasSeparadas[x], vectorConectores) == -1) {
                        fraseDefinitiva += " AND ";
                        fraseDefinitiva += palabrasSeparadas[x];
                    }
                }

                palabra = fraseDefinitiva;
            }

            var texto = "";
            var ofertas = $("#ofertas");
            ofertas.empty();

            var nom_mun = localStorage.getItem('NombreMunicipio');
            var nom_sal = localStorage.getItem('NombreSalario');
            var nom_exp = localStorage.getItem('NombreExperiencia');
            var nom_niv = localStorage.getItem('NombreNivel');
            var municipio = localStorage.getItem('Municipio');
            var tipo = localStorage.getItem('Oportunidad');
            var salario = localStorage.getItem('Salario');
            var experiencia = localStorage.getItem('Experiencia');
            var nivel = localStorage.getItem('Nivel');
            var vacantesGuardadas = localStorage.getItem("vacantesGuardadas");
            $.ajax({
                url: 'http://apiempleo.apphb.com/api/Vacante/obtenerVacantes?palabra=' + palabra + '&tipo=' + tipo + '&salario=' + salario + '&experiencia=' + experiencia + '&nivel=' + nivel + '&municipio=' + municipio,
                type: 'POST',
                dataType: 'json',
                success: function (data, textStatus, xhr) {
                    
                },
                error: function (xhr, textStatus, errorThrown) {
                    //alert(errorThrown);
                    OcultarDivCargando();
                    alert("Ha ocurrido un problema, inténtelo nuevamente.");
                }
            });
        }

    </script>
</head>
<body>
    <div id="div-confirm" style="display:none">
        <div id="content-alert">
        </div>
    </div>
    <div id="preloader">
        <div id="status">
            <p class="center-text">
                Cargando contenido... <em>La carga depende de su conexión a internet!</em>
            </p>
        </div>
    </div>
    <div class="all-elements">
        <div id="sidebar" class="page-sidebar">
            <div class="page-sidebar-scroll">
                <div class="sidebar-shortcuts">
                    <a href="#" class="shortcut-close"></a>
                </div>
                <div class="sidebar-search">
                    <div class="search-box">
                        <input type="text" class="search-field" name="search" onfocus="if(this.value == 'Looking for something?') { this.value = ''; }"
                               value="Looking for something?">
                        <a href="#" class="search-close"></a>
                    </div>
                </div>
                <div class="sidebar-logo">
                    <img src="images/logo_odc.png" height="52" alt="img">
                </div>
                <div class="sidebar-breadcrumb">
                    BUSCO EMPLEO
                </div>
                <div class="navigation-item">
                    <a href="index.html" class="nav-item home-icon">Oportunidades de empleo<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration">
                </div>
                <div class="navigation-item">
                    <a href="vacantes_favoritas.html" class="nav-item home-favoritas">
                        Mis vacantes favoritas<em class="selected-item"></em>
                    </a>
                </div>
                <div class="sidebar-decoration">
                </div>
                <div class="sidebar-breadcrumb">
                    SOY EMPLEADOR
                </div>
                <div class="navigation-item">
                    <a href="#" class="nav-item home-admin submenu-deploy">
                        Sección del empleador<em class="dropdown-item"></em>
                    </a>
                    <div class="sidebar-decoration">
                    </div>
                    <div class="nav-submenu">
                        <a id="opc_Sesion" href="inicio-sesion.html">
                            Inicio sesion<em class="unselected-item"></em>
                        </a>
                        <a id="opc_Registrar" name="opc_Registrar" href="RegistrarOferta.html">
                            Publicar vacante nueva<em class="unselected-item"></em>
                        </a>
                        <a id="opc_VerMias" name="opc_VerMias" href="lista_ofertas_empleador.html">
                            Gestionar vacantes<em class="unselected-item"></em>
                        </a>
                    </div>
                </div>
                <div class="sidebar-decoration">
                </div>
                <div class="sidebar-breadcrumb">
                    INFORMACIÓN
                </div>
                <div class="navigation-item">
                    <a href="faqs.html" class="nav-item home-faqs">Preguntas Frecuentes<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration">
                </div>
                <div class="navigation-item">
                    <a href="acerca.html" class="nav-item home-info-about">Acerca de<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration">
                </div>
                <div class="sidebar-breadcrumb">
                    SERVICIO DE EMPLEO MÓVIL 2014
                </div>
            </div>
        </div>
        <div id="content" class="page-content">
            <div class="page-header" id="header">
                <a href="#" class="deploy-sidebar"></a>
                <label class="header-logo">SERVICIO DE EMPLEO MÓVIL</label>
            </div>
            <div class="page-header-clear">
            </div>
            <div class="content">
                <div class="decoration">
                </div>
                <div class="container no-bottom" style="text-align: center;">
                    <h3>
                        VACANTES FAVORITAS</h3>
                </div>
                <div class="decoration">
                </div>
                <div class="container no-bottom">
                    <div class="big-notification blue-notification">
                        <h4>
                            En esta sección encontrará la lista de vacantes pre-seleccionadas por usted y que todavía se encuentran vigentes</h4>
                        <a href="#" class="close-big-notification">X</a>
                    </div>
                </div>
                <div class="decoration">
                </div>
                <div class="container no-bottom" id="div_sin_favoritas">
                    <div class="big-notification red-notification">
                        <h4>
                            Usted no tiene vacantes favoritas vigentes
                        </h4>
                        <a href="#" class="close-big-notification">X</a>
                    </div>
                </div>
                <div id="ofertas">
                </div>
                <div class="decoration">
                </div>
                <div class="container">
                    <div class="footer-socials" style="width:100%;">
                        <div style="float:left;width:50%; padding-right: 3%;">
                            <a href="https://www.facebook.com/SPEColombia?fref=ts" target="_blank" class="facebook-footer" style="float:right;"></a>
                        </div>
                        <div style="float:left;width:50%; padding-left: 3%;">
                            <a href="https://twitter.com/ServiciodEmpleo" target="_blank" class="twitter-footer" style="float:left;"></a>
                            <a href="#" class="goup-footer" style="float:right;"></a>
                        </div>
                    </div>
                    <p class="copyright uppercase center-text no-bottom">SERVICIO DE EMPLEO MÓVIL 2014<br> Todos los derechos reservados</p>
                </div>
            </div>
        </div>
    </div>
    <div class="cuadro-internet-connection">
        <div id="div-internet-connection" class="circulo-internet-connection"></div>
        <label style="padding-left: 12px;" id="label-internet-connection">Online</label>
    </div>
</body>
</html>